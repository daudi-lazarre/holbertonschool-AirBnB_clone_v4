## 16. Search
# advanced


For the moment, the only way to list `Place` objects is via `GET /api/v1/cities/<city_id>/places`.

Good, but not enough…

Update `api/v1/views/places.py` to add a new endpoint: `POST /api/v1/places_search` that retrieves all `Place` objects depending of the JSON in the body of the request.

The JSON can contain 3 optional keys:

- `states`: list of `State` ids
- `cities`: list of `City` ids
- `amenities`: list of `Amenity` ids

Search rules:

- If the HTTP request body is not valid JSON, raise a `400` error with the message `Not a JSON`
- If the JSON body is empty or each list of all keys are empty: retrieve all `Place` objects
- If `states` list is not empty, results should include all Place objects for each State id listed
- If `cities` list is not empty, results should include all Place objects for each City id listed
- Keys `states` and `cities` are inclusive. Search results should include all `Place` objects in storage related to each `City` in every `State` listed in states, plus every `City` listed individually in `cities`, unless that `City` was already included by `states`.
	- Context:
		- State A has 2 cities A1 and A2
		- State B has 3 cities B1, B2 and B3
		- A1 has 1 place
		- A2 has 2 places
		- B1 has 3 places
		- B2 has 4 places
		- B3 has 5 places
	- Search: states = State A and cities = B2
	- Result: all 4 places from the city B2 and the place from the city A1 and the 2 places of the city A2 (because they are part of State A) => 7 places returned
- If `amenities` list is not empty, limit search results to only `Place` objects having all `Amenity` ids listed
- The key `amenities` is exclusive, acting as a filter on the results generated by `states` and `cities`, or on all `Place` if states and cities are both empty or missing.
- Results will only include `Place` objects having all listed `amenities`. If a `Place` doesn’t have even one of these `amenities`, it won’t be retrieved.

```
guillaume@ubuntu:~/AirBnB_v3$ curl -X POST http://0.0.0.0:5000/api/v1/places_search -H "Content-Type: application/json" -d '{"states": ["2b9a4627-8a9e-4f32-a752-9a84fa7f4efd", "459e021a-e794-447d-9dd2-e03b7963f7d2"], "cities": ["5976f0e7-5c5f-4949-aae0-90d68fd239c0"]}'
[
  {
    "__class__": "Place", 
    "created_at": "2017-03-25T02:17:06", 
    "id": "dacec983-cec4-4f68-bd7f-af9068a305f5", 
    "name": "The Lynn House", 
    "city_id": "5976f0e7-5c5f-4949-aae0-90d68fd239c0", 
    "user_id": "3ea61b06-e22a-459b-bb96-d900fb8f843a", 
    "description": "Our place is 2 blocks from Vista Park (Farmer's Market), Historic Warren Ballpark, and about 2 miles from Old Bisbee where there is shopping, dining, and site seeing. We offer continental breakfast. You get the quiet life with great mountain and garden views. This is a 100+ year old cozy home which has been on both the Garden and Home tours. You have access to whole house, except for 1 restricted area (She-Shack).  Hosts are on site in a casita in the back from 8pm until 7am when we are in town.<BR /><BR />Our home has two bedrooms, one king and one queen.  There are 2 bathrooms, 1  1950's soak tub with shower and 1 with shower only.  Guests have access to the living/dining room area, and the kitchen (except for use of stove/oven).  Each morning, coffee/tea, and muffins are ready for guests.  A small frig is available in the dining room with water/juice and an area for guest items.  1 parking space is directly across the street.", 
    "number_rooms": 2,
    "number_bathrooms": 2,
    "max_guest": 4,
    "price_by_night": 82, 
    "latitude": 31.4141, 
    "longitude": -109.879, 
    "updated_at": "2017-03-25T02:17:06"
  },
    {
    "__class__": "Place", 
    "created_at": "2017-03-25T12:17:06", 
    "id": "85f979ad-a345-4190-9d1b-719bb3c642ba", 
    "name": "Little blue House in New Orleans", 
    "city_id": "1da255c0-f023-4779-8134-2b1b40f87683", 
    "user_id": "44b3ab44-4798-4a3a-9f72-ee1eeace4b33", 
    "description": "Nice place closed to Bourbon street.", 
    "number_rooms": 1,
    "number_bathrooms": 1,
    "max_guest": 3,
    "price_by_night": 42, 
    "latitude": 29.951065, 
    "longitude": -90.071533, 
    "updated_at": "2017-03-25T02:17:06"
  },
...
guillaume@ubuntu:~/AirBnB_v3$ 
```


## Repo:

GitHub repository: `holbertonschool-AirBnB_clone_v3`
File: `api/v1/views/places.py`
